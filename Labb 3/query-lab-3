-- 1. Find the country with the fewest number of borders.
WITH CombinedBorders AS (
    SELECT
        c.Name AS country_name,
        b.Country2 AS border_country
    FROM
        Country c
    JOIN
        borders b ON c.Code = b.Country1
    UNION
    SELECT
        c.Name AS country_name,
        b.Country1 AS border_country
    FROM
        Country c
    JOIN
        borders b ON c.Code = b.Country2
),
BorderCounts AS (
    SELECT
        country_name,
        COUNT(DISTINCT border_country) AS border_count
    FROM
        CombinedBorders
    GROUP BY
        country_name
)
SELECT
    country_name,
    border_count
FROM
    BorderCounts
WHERE
    border_count = (SELECT MIN(border_count) FROM BorderCounts)
ORDER BY
    country_name ASC;



Task 2
SELECT 
    -- Select the 'language' column from the 'spoken' table (s)
    s.language,

    -- Calculate the estimated number of speakers for each language
    -- Multiply the country's population by the percentage (converted to a fraction) of people who speak the language
    -- Sum this value across all countries for each language
    -- CAST the result to BIGINT to ensure it is an integer
    CAST(SUM(c.population * (s.percentage / 100.0)) AS BIGINT) AS numberspeaker
FROM 
    -- From the 'country' table (c) which contains country data, including population
    country c
JOIN 
    -- Join with the 'spoken' table
    spoken s 
ON 
-- Join condition: match the country code in 'country' table with the country code in 'spoken' table
    c.code = s.country
GROUP BY 
-- Group the results by language 
    s.language
HAVING 
-- Filter out languages with zero speakers
    SUM(c.population * (s.percentage / 100.0)) > 0
ORDER BY 
-- Order the results by the number of speakers, in descending order
    numberspeaker DESC;

Task 3
WITH BorderCountryGdp AS(
    SELECT
        c.Code AS country1,                      -- Show country 1 code
        e1.GDP AS gdp1,                  -- Show GDP for country 1
        b.Country2 AS country2,                   -- Show the code of the bordering country (Country2)
        e2.GDP AS gdp2                    -- Show GDP for country 2
    FROM
        Country c
    JOIN
        borders b ON c.Code = b.Country1           -- Join with borders table on country 1
    JOIN
        economy e1 ON c.Code = e1.country         -- Join with economy table for country 1 GDP
    JOIN
        economy e2 ON b.Country2 = e2.country    -- Join with economy table for country 2 GDP
    WHERE 
        e1.gdp IS NOT NULL
        AND e2.gdp IS NOT NULL
)
SELECT 
    country1,
    gdp1,
    country2,
    gdp2,
    CAST((GREATEST(gdp1,gdp2) / LEAST(gdp1, gdp2) )AS BIGINT) AS ratio 
FROM
    BorderCountryGdp
ORDER BY ratio DESC;
